/*!  1.6.42 2020-07-07 15:19 */

CHARITABLE=window.CHARITABLE||{},function(t,e){function i(e){var o=this,i=e.data("params"),a=new plupload.Uploader(i);this.$dragdrop=e,this.$dropzone=t(a.settings.drop_element),this.$images=t("#"+e.data("images")),this.$loader=this.$dragdrop.find(".charitable-drag-drop-image-loader").first(),this.max_file_uploads=i.multipart_params.max_uploads,this.max_file_size=parseInt(this.$dragdrop.data("max-size"),10),this.uploaded=this.$images.children().length,this.max_uploads_alert_shown=!1,this.max_upload_size_alert_shown=!1,a.init(),a.bind("Init",function(e){o.Init(e)}),a.bind("PostInit",function(e){e.refresh()}),a.bind("FileFiltered",function(e,i){o.FileFiltered(e,i)}),a.bind("FilesAdded",function(e,i){o.FilesAdded(e,i)}),a.bind("Error",function(e,i){console.log(i)}),a.bind("FileUploaded",function(e,i,a){o.FileUploaded(e,i,a)})}i.prototype.Init=function(i){var a=this;this.$dropzone&&(i.features.dragdrop&&!this.$dragdrop.parent().hasClass("mobile")&&(this.$dragdrop.parent().addClass("supports-drag-drop"),this.$dropzone.bind("dragover",function(){a.$dropzone.addClass("drag-over")}),this.$dropzone.bind("dragleave",function(){a.$dropzone.removeClass("drag-over")})),this.$dragdrop.on("click",".remove-image",function(e){return e.preventDefault(),a.remove_image(t(this),i)}))},i.prototype.FileFiltered=function(e,i){return this.max_file_uploads&&this.uploaded>=this.max_file_uploads?(this.max_uploads_alert_shown||window.alert(this.get_max_uploads_message()),this.max_uploads_alert_shown=!0,e.removeFile(i)):i.size>=this.max_file_size?(this.max_upload_size_alert_shown||window.alert(CHARITABLE_UPLOAD_VARS.max_file_size.replace("%1$s",i.name).replace("%2$s",this.bytes_to_mb(this.max_file_size))),this.max_upload_size_alert_shown=!0,e.removeFile(i)):(this.uploaded+=1,this.uploaded===this.max_file_uploads&&this.hide_dropzone(),void this.add_image_loader(i))},i.prototype.FilesAdded=function(e,i){this.$dropzone.removeClass("drag-over"),this.max_uploads_alert_shown=!1,this.max_upload_size_alert_shown=!1,e.refresh(),e.start()},i.prototype.FileUploaded=function(e,i,a){(a=t.parseJSON(a.response)).success?(this.hide_image_loader(i),this.$images.append(a.data)):this.add_image_error(i,CHARITABLE_UPLOAD_VARS.upload_problem.replace("%s",i.name))},i.prototype.get_max_uploads_message=function(){return(1<this.max_file_uploads?CHARITABLE_UPLOAD_VARS.max_file_uploads_plural:CHARITABLE_UPLOAD_VARS.max_file_uploads_single).replace("%d",this.max_file_uploads)},i.prototype.add_image_loader=function(e){this.$loader.fadeIn(300),this.$loader.children(".images").append('<li data-file-id="'+e.id+'" class="">'+e.name+"</li>")},i.prototype.hide_image_loader=function(e){this.$loader.find("[data-file-id="+e.id+"]").remove(),this.$loader.find(".images li").length||this.$loader.hide()},i.prototype.remove_image=function(e,i){return e.parent().fadeOut(300,function(){this.remove()}),this.$dropzone.fadeIn(300),--this.uploaded,i.refresh(),!1},i.prototype.hide_dropzone=function(){this.$dropzone.removeClass("drag-over"),this.$dropzone.hide()},i.prototype.bytes_to_mb=function(e){var i=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,i)).toFixed(2)+" "+["B","kB","MB","GB","TB"][i]},i.prototype.add_image_error=function(e,i){var a=this;a.$dropzone.fadeIn(300),a.$loader.find("[data-file-id="+e.id+"]").addClass("error").text(i).delay(5e3).fadeOut(300,function(){a.hide_image_loader(e)})},e.Uploader=i,t(document).ready(function(){t(".charitable-drag-drop").each(function(){new i(t(this))})})}(jQuery,CHARITABLE);